{
  "feature": "Add pagination to admin List endpoints",
  "description": "Implement pagination for domain, user, and alias List handlers using the existing PaginatedResponse middleware. Currently these handlers return all records without pagination.",
  "created_at": "2026-01-05T22:01:07.555Z",
  "updated_at": "2026-01-06T04:06:03.144Z",
  "status": "backlog",
  "planStatus": "pending",
  "phases": [
    {
      "id": "phase-1",
      "name": "Repository Layer - Add Count and ListPaginated Methods",
      "description": "Add Count() methods to repository interfaces and implementations for pagination metadata, and add ListPaginated to User and Alias repositories",
      "subtasks": [
        {
          "id": "1.1",
          "description": "Add Count() method to DomainRepository interface",
          "file": "internal/repository/interfaces.go",
          "status": "completed",
          "details": "Add Count() (int, error) to DomainRepository interface",
          "notes": "Added Count() (int, error) method to DomainRepository interface in internal/repository/interfaces.go",
          "updated_at": "2026-01-06T01:10:28.581352+00:00"
        },
        {
          "id": "1.2",
          "description": "Implement Count() in SQLite domain repository",
          "file": "internal/repository/sqlite/domain_repository.go",
          "status": "completed",
          "details": "Add Count() method that executes SELECT COUNT(*) FROM domains",
          "notes": "Implemented Count() method in SQLite domain repository that executes SELECT COUNT(*) FROM domains. Follows existing code patterns with proper error handling and wrapping.",
          "updated_at": "2026-01-06T01:11:32.131146+00:00"
        },
        {
          "id": "1.3",
          "description": "Add ListPaginated() and Count() methods to UserRepository interface",
          "file": "internal/repository/interfaces.go",
          "status": "pending",
          "details": "Add ListPaginated(offset, limit int) ([]*domain.User, error) and Count() (int, error)"
        },
        {
          "id": "1.4",
          "description": "Implement ListPaginated() and Count() in SQLite user repository",
          "file": "internal/repository/sqlite/user_repository.go",
          "status": "pending",
          "details": "Add ListPaginated() with LIMIT/OFFSET and Count() with SELECT COUNT(*) FROM users"
        },
        {
          "id": "1.5",
          "description": "Add ListPaginated() and Count() methods to AliasRepository interface",
          "file": "internal/repository/interfaces.go",
          "status": "pending",
          "details": "Add ListPaginated(offset, limit int) ([]*domain.Alias, error) and Count() (int, error)"
        },
        {
          "id": "1.6",
          "description": "Implement ListPaginated() and Count() in SQLite alias repository",
          "file": "internal/repository/sqlite/alias_repository.go",
          "status": "pending",
          "details": "Add ListPaginated() with LIMIT/OFFSET and Count() with SELECT COUNT(*) FROM aliases"
        }
      ]
    },
    {
      "id": "phase-2",
      "name": "Service Layer - Add Pagination Methods",
      "description": "Add pagination-aware methods to service layer that return items and total count",
      "subtasks": [
        {
          "id": "2.1",
          "description": "Add ListPaginated() and Count() to DomainService",
          "file": "internal/service/domain_service.go",
          "status": "pending",
          "details": "Update List() to accept offset/limit params and add Count() method, remove the TODO comment"
        },
        {
          "id": "2.2",
          "description": "Add ListPaginated() and Count() to UserService",
          "file": "internal/service/user_service.go",
          "status": "pending",
          "details": "Add ListPaginated(ctx, offset, limit) and Count(ctx) methods"
        },
        {
          "id": "2.3",
          "description": "Add ListPaginated() and Count() to AliasService",
          "file": "internal/service/alias_service.go",
          "status": "pending",
          "details": "Add ListPaginated(ctx, offset, limit) and Count(ctx) methods"
        }
      ]
    },
    {
      "id": "phase-3",
      "name": "Handler Layer - Implement Pagination",
      "description": "Update admin handlers to parse pagination query params and use RespondPaginated",
      "subtasks": [
        {
          "id": "3.1",
          "description": "Add pagination helper function to handlers package",
          "file": "internal/api/handlers/pagination.go",
          "status": "pending",
          "details": "Create helper function ParsePaginationParams(r *http.Request) (page, limit, offset int) with defaults page=1, limit=50, max_limit=100"
        },
        {
          "id": "3.2",
          "description": "Update DomainHandler.List with pagination",
          "file": "internal/api/handlers/domain_handler.go",
          "status": "pending",
          "details": "Parse page/limit params, call service.ListPaginated(), use middleware.RespondPaginated()"
        },
        {
          "id": "3.3",
          "description": "Update UserHandler.List with pagination",
          "file": "internal/api/handlers/user_handler.go",
          "status": "pending",
          "details": "Parse page/limit params, call service.ListPaginated(), use middleware.RespondPaginated(), remove TODO comment"
        },
        {
          "id": "3.4",
          "description": "Update AliasHandler.List with pagination",
          "file": "internal/api/handlers/alias_handler.go",
          "status": "pending",
          "details": "Parse page/limit params, call service.ListPaginated(), use middleware.RespondPaginated(), remove TODO comment"
        }
      ]
    },
    {
      "id": "phase-4",
      "name": "Testing",
      "description": "Add unit tests for pagination functionality",
      "subtasks": [
        {
          "id": "4.1",
          "description": "Add tests for pagination helper function",
          "file": "internal/api/handlers/pagination_test.go",
          "status": "pending",
          "details": "Test ParsePaginationParams with various inputs: defaults, valid values, edge cases"
        },
        {
          "id": "4.2",
          "description": "Add tests for DomainHandler.List pagination",
          "file": "internal/api/handlers/domain_handler_test.go",
          "status": "pending",
          "details": "Test pagination params, response format, edge cases"
        },
        {
          "id": "4.3",
          "description": "Add tests for UserHandler.List pagination",
          "file": "internal/api/handlers/user_handler_test.go",
          "status": "pending",
          "details": "Test pagination params, response format, edge cases"
        },
        {
          "id": "4.4",
          "description": "Add tests for AliasHandler.List pagination",
          "file": "internal/api/handlers/alias_handler_test.go",
          "status": "pending",
          "details": "Test pagination params, response format, edge cases"
        },
        {
          "id": "4.5",
          "description": "Run full test suite and verify build",
          "file": null,
          "status": "pending",
          "details": "Run go test ./... and ensure all tests pass, run go build to verify compilation"
        }
      ]
    }
  ],
  "workflow_type": "development",
  "services_involved": [
    "internal/repository/interfaces.go",
    "internal/repository/sqlite/domain_repository.go",
    "internal/repository/sqlite/user_repository.go",
    "internal/repository/sqlite/alias_repository.go",
    "internal/service/domain_service.go",
    "internal/service/user_service.go",
    "internal/service/alias_service.go",
    "internal/api/handlers/domain_handler.go",
    "internal/api/handlers/user_handler.go",
    "internal/api/handlers/alias_handler.go",
    "internal/api/middleware/responses.go"
  ],
  "final_acceptance": [
    "GET /api/v1/admin/domains returns paginated response with page, page_size, total_pages, total_items fields",
    "GET /api/v1/admin/users returns paginated response with page, page_size, total_pages, total_items fields",
    "GET /api/v1/admin/aliases returns paginated response with page, page_size, total_pages, total_items fields",
    "All endpoints accept ?page=N&limit=N query parameters",
    "Default page is 1, default limit is 50, max limit is 100",
    "All existing tests pass",
    "New pagination tests pass",
    "Build succeeds without errors"
  ],
  "spec_file": "spec.md",
  "api_changes": {
    "breaking": false,
    "notes": "Response format changes from {data: [...], message: '...'} to {data: [...], page: N, page_size: N, total_pages: N, total_items: N}. Clients should handle both formats for backward compatibility."
  },
  "last_updated": "2026-01-06T01:11:32.131156+00:00"
}