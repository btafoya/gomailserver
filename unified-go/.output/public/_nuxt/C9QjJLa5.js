import{_ as gt}from"./TWhVIJrq.js";import{_ as xt}from"./DQxZl4Gi.js";import{_ as bt}from"./Dzup3tpv.js";import{_ as yt}from"./DDnXcZAG.js";import{_ as Ct}from"./BAwcxMjs.js";import{_ as Ut}from"./CLuzgwfI.js";import{_ as Rt}from"./BaZuvFz9.js";import{useReputationPhase5Api as kt}from"./DUWfgsoE.js";import{R as W}from"./D0UlAAtA.js";import{D as z}from"./74XN7BgN.js";import{L as wt}from"./BZDPJRid.js";import{F as Dt,C as At,a as Tt}from"./BjlBhWUj.js";import{C as Ft}from"./98tBQm4Q.js";import{f as St,q as U,p as O,S as Vt,y as $t,c as A,a as o,b as e,E as R,g as H,w as l,D as p,o as m,d as i,C as v,F as Y,G as Z,t as s}from"./BUcYa01A.js";import"./DAzf46mh.js";import"./CYi_maFl.js";import"./ZLFFUBy4.js";import"./ChGbc9Ds.js";import"./vkYvzIJb.js";import"./BDTT5SEM.js";const Mt={class:"space-y-6"},Lt={class:"flex items-center justify-between"},Bt={class:"grid grid-cols-1 md:grid-cols-4 gap-4"},Et={class:"space-y-2"},zt={class:"space-y-2"},It={class:"space-y-2"},Pt={class:"space-y-2"},jt={class:"grid grid-cols-1 md:grid-cols-4 gap-4"},Ot={class:"text-2xl font-bold"},Ht={class:"text-xs text-gray-500 mt-1"},Nt={class:"text-2xl font-bold"},ht={class:"text-2xl font-bold"},Kt={class:"text-2xl font-bold text-red-600"},Xt={class:"text-xs text-gray-500 mt-1"},qt={class:"flex items-center justify-between"},Gt={class:"flex gap-2"},Jt={key:0,class:"flex items-center justify-center py-12"},Qt={key:1,class:"text-center py-12"},Wt={class:"text-xs"},Yt={class:"flex gap-2"},Zt={class:"space-y-4"},te={class:"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm"},ee={class:"font-mono"},le={class:"font-mono"},oe={class:"grid grid-cols-2 md:grid-cols-4 gap-4"},ne={class:"text-xl font-bold"},ae={class:"text-xs text-gray-400"},se={class:"text-xl font-bold"},de={class:"text-xs text-gray-400"},ie={class:"text-xl font-bold"},re={class:"text-xs text-gray-400"},ue={class:"text-xl font-bold text-red-600"},_e={class:"text-xs text-gray-400"},me={key:3,class:"flex items-center justify-between mt-4"},ce={class:"text-sm text-gray-500"},pe={class:"flex gap-2"},Ee=St({__name:"index",setup(fe){const{listDMARCReports:tt,getDMARCStats:N,exportDMARCReport:et}=kt(),u=U([]),_=U({total_reports:0,total_records:0,spf_aligned_count:0,dkim_aligned_count:0,both_aligned_count:0,failed_count:0,spf_alignment_rate:0,dkim_alignment_rate:0,overall_alignment_rate:0}),w=U(!1),T=U(null),C=U(1),M=U(20),L=U(0),h=O(()=>Math.ceil(L.value/M.value)),c=U({domain:"",org_name:"",date_from:"",date_to:""}),F=U([]),lt=O(()=>u.value),K=O(()=>[...new Set(u.value.map(t=>t.domain))].sort()),B=async()=>{w.value=!0,T.value=null;try{const n=await tt(C.value,M.value);u.value=n.data,L.value=n.total,u.value.length>0&&c.value.domain&&(stats.value=await N(c.value.domain))}catch(n){T.value=n.message||"Failed to load DMARC reports"}finally{w.value=!1}},S=async n=>{if(!n){_.value={total_reports:u.value.length,total_records:u.value.reduce((a,r)=>a+r.record_count,0),spf_aligned_count:u.value.reduce((a,r)=>a+r.spf_aligned_count,0),dkim_aligned_count:u.value.reduce((a,r)=>a+r.dkim_aligned_count,0),both_aligned_count:u.value.reduce((a,r)=>a+(r.both_aligned_count||0),0),failed_count:u.value.reduce((a,r)=>a+r.failed_count,0),spf_alignment_rate:0,dkim_alignment_rate:0,overall_alignment_rate:0};const t=_.value.total_records;t>0&&(_.value.spf_alignment_rate=_.value.spf_aligned_count/t,_.value.dkim_alignment_rate=_.value.dkim_aligned_count/t,_.value.overall_alignment_rate=_.value.both_aligned_count/t);return}try{_.value=await N(n)}catch(t){console.error("Failed to load DMARC statistics:",t)}},E=async()=>{C.value=1,await B(),c.value.domain?await S(c.value.domain):await S()},ot=async()=>{await B(),c.value.domain?await S(c.value.domain):await S()},nt=n=>{const t=F.value.indexOf(n);t>-1?F.value.splice(t,1):F.value.push(n)},X=async(n,t)=>{try{const a=await et(n),r=URL.createObjectURL(a),g=document.createElement("a");g.href=r,g.download=`dmarc-report-${n}.${t}`,document.body.appendChild(g),g.click(),document.body.removeChild(g),URL.revokeObjectURL(r)}catch(a){T.value=a.message||`Failed to export report as ${t.toUpperCase()}`}},at=async()=>{const n=dt(u.value);q(n,"dmarc-reports.csv","text/csv")},st=async()=>{const n=it(u.value);q(n,"dmarc-reports.xml","application/xml")},dt=n=>{const t=["Domain","Organization","Report ID","Email Address","Begin Time","End Time","Records","SPF Aligned","DKIM Aligned","Both Aligned","Failed"],a=n.map(r=>[r.domain,r.org_name,r.report_id,r.email_address,D(r.begin_time),D(r.end_time),r.record_count,r.spf_aligned_count,r.dkim_aligned_count,r.both_aligned_count||0,r.failed_count]);return[t,...a].map(r=>r.join(",")).join(`
`)},it=n=>`<?xml version="1.0" encoding="UTF-8"?>
<dmarc_reports>
${n.map(a=>`
  <report>
    <domain>${a.domain}</domain>
    <org_name>${a.org_name}</org_name>
    <report_id>${a.report_id}</report_id>
    <email_address>${a.email_address}</email_address>
    <begin_time>${D(a.begin_time)}</begin_time>
    <end_time>${D(a.end_time)}</end_time>
    <record_count>${a.record_count}</record_count>
    <spf_aligned_count>${a.spf_aligned_count}</spf_aligned_count>
    <dkim_aligned_count>${a.dkim_aligned_count}</dkim_aligned_count>
    <both_aligned_count>${a.both_aligned_count||0}</both_aligned_count>
    <failed_count>${a.failed_count}</failed_count>
  </report>`).join("")}
</dmarc_reports>`,q=(n,t,a)=>{const r=new Blob([n],{type:a}),g=URL.createObjectURL(r),k=document.createElement("a");k.href=g,k.download=t,document.body.appendChild(k),k.click(),document.body.removeChild(k),URL.revokeObjectURL(g)},G=n=>new Date(n*1e3).toLocaleDateString(),D=n=>new Date(n*1e3).toLocaleString(),J=(n,t)=>{const a=n/t;return a>=.95?"default":a>=.9?"secondary":a>=.8?"outline":"destructive"};return Vt(C,()=>{B()}),$t(()=>{B(),S()}),(n,t)=>{const a=gt,r=p("USelectValue"),g=p("USelectTrigger"),k=p("USelectItem"),rt=p("USelectContent"),ut=xt,I=bt,x=p("UCardContent"),b=yt,V=p("UCardTitle"),$=p("UCardHeader"),y=p("UTableHead"),P=p("UTableRow"),_t=p("UTableHeader"),f=p("UTableCell"),j=Ct,mt=p("UTableBody"),ct=Ut,pt=p("UAlertTitle"),ft=p("UAlertDescription"),vt=Rt;return m(),A("div",Mt,[o("div",Lt,[t[7]||(t[7]=o("div",null,[o("h1",{class:"text-2xl font-bold"},"DMARC Reports"),o("p",{class:"text-sm text-gray-500 mt-1"}," View and analyze DMARC RUA reports for your domains ")],-1)),e(a,{variant:"outline",size:"sm",onClick:ot,disabled:w.value},{default:l(()=>[w.value?(m(),R(v(W),{key:0,class:"h-4 w-4 animate-spin mr-2"})):(m(),R(v(W),{key:1,class:"h-4 w-4 mr-2"})),t[6]||(t[6]=i(" Refresh ",-1))]),_:1},8,["disabled"])]),e(b,null,{default:l(()=>[e(x,{class:"pt-6"},{default:l(()=>[o("div",Bt,[o("div",Et,[t[9]||(t[9]=o("label",{class:"text-sm font-medium"},"Domain",-1)),e(ut,{modelValue:c.value.domain,"onUpdate:modelValue":[t[0]||(t[0]=d=>c.value.domain=d),E]},{default:l(()=>[e(g,null,{default:l(()=>[e(r,{placeholder:"All domains"})]),_:1}),e(rt,null,{default:l(()=>[e(k,{value:""},{default:l(()=>[...t[8]||(t[8]=[i("All domains",-1)])]),_:1}),(m(!0),A(Y,null,Z(K.value,d=>(m(),R(k,{key:d,value:d},{default:l(()=>[i(s(d),1)]),_:2},1032,["value"]))),128))]),_:1})]),_:1},8,["modelValue"])]),o("div",zt,[t[10]||(t[10]=o("label",{class:"text-sm font-medium"},"Organization",-1)),e(I,{modelValue:c.value.org_name,"onUpdate:modelValue":t[1]||(t[1]=d=>c.value.org_name=d),placeholder:"Filter by org name",onInput:E},null,8,["modelValue"])]),o("div",It,[t[11]||(t[11]=o("label",{class:"text-sm font-medium"},"Date From",-1)),e(I,{modelValue:c.value.date_from,"onUpdate:modelValue":t[2]||(t[2]=d=>c.value.date_from=d),type:"date",onInput:E},null,8,["modelValue"])]),o("div",Pt,[t[12]||(t[12]=o("label",{class:"text-sm font-medium"},"Date To",-1)),e(I,{modelValue:c.value.date_to,"onUpdate:modelValue":t[3]||(t[3]=d=>c.value.date_to=d),type:"date",onInput:E},null,8,["modelValue"])])])]),_:1})]),_:1}),o("div",jt,[e(b,null,{default:l(()=>[e($,{class:"pb-2"},{default:l(()=>[e(V,{class:"text-sm font-medium"},{default:l(()=>[...t[13]||(t[13]=[i("Total Reports",-1)])]),_:1})]),_:1}),e(x,null,{default:l(()=>[o("div",Ot,s(_.value.total_reports||0),1),o("p",Ht,"Across "+s(K.value.length)+" domain(s)",1)]),_:1})]),_:1}),e(b,null,{default:l(()=>[e($,{class:"pb-2"},{default:l(()=>[e(V,{class:"text-sm font-medium"},{default:l(()=>[...t[14]||(t[14]=[i("Total Records",-1)])]),_:1})]),_:1}),e(x,null,{default:l(()=>[o("div",Nt,s(_.value.total_records||0),1),t[15]||(t[15]=o("p",{class:"text-xs text-gray-500 mt-1"},"Email messages analyzed",-1))]),_:1})]),_:1}),e(b,null,{default:l(()=>[e($,{class:"pb-2"},{default:l(()=>[e(V,{class:"text-sm font-medium"},{default:l(()=>[...t[16]||(t[16]=[i("Pass Rate",-1)])]),_:1})]),_:1}),e(x,null,{default:l(()=>[o("div",ht,s((_.value.overall_alignment_rate*100).toFixed(1))+"%",1),t[17]||(t[17]=o("p",{class:"text-xs text-gray-500 mt-1"}," SPF + DKIM alignment ",-1))]),_:1})]),_:1}),e(b,null,{default:l(()=>[e($,{class:"pb-2"},{default:l(()=>[e(V,{class:"text-sm font-medium"},{default:l(()=>[...t[18]||(t[18]=[i("Failed",-1)])]),_:1})]),_:1}),e(x,null,{default:l(()=>[o("div",Kt,s(_.value.failed_count||0),1),o("p",Xt,s((_.value.failed_count/_.value.total_records*100||0).toFixed(2))+"% of records ",1)]),_:1})]),_:1})]),e(b,null,{default:l(()=>[e($,null,{default:l(()=>[o("div",qt,[e(V,null,{default:l(()=>[...t[19]||(t[19]=[i("Reports",-1)])]),_:1}),o("div",Gt,[e(a,{variant:"outline",size:"sm",onClick:at,disabled:w.value||u.value.length===0},{default:l(()=>[e(v(z),{class:"h-4 w-4 mr-2"}),t[20]||(t[20]=i(" Export CSV ",-1))]),_:1},8,["disabled"]),e(a,{variant:"outline",size:"sm",onClick:st,disabled:w.value||u.value.length===0},{default:l(()=>[e(v(z),{class:"h-4 w-4 mr-2"}),t[21]||(t[21]=i(" Export XML ",-1))]),_:1},8,["disabled"])])])]),_:1}),e(x,null,{default:l(()=>[w.value&&u.value.length===0?(m(),A("div",Jt,[e(v(wt),{class:"h-8 w-8 animate-spin text-gray-400"})])):u.value.length===0?(m(),A("div",Qt,[e(v(Dt),{class:"h-12 w-12 mx-auto text-gray-400 mb-4"}),t[22]||(t[22]=o("p",{class:"text-gray-500"},"No DMARC reports found",-1)),t[23]||(t[23]=o("p",{class:"text-sm text-gray-400 mt-1"}," Configure DMARC RUA (reporting URI) on your domains to receive reports ",-1))])):(m(),R(ct,{key:2},{default:l(()=>[e(_t,null,{default:l(()=>[e(P,null,{default:l(()=>[e(y,{class:"w-[30px]"}),e(y,null,{default:l(()=>[...t[24]||(t[24]=[i("Domain",-1)])]),_:1}),e(y,null,{default:l(()=>[...t[25]||(t[25]=[i("Organization",-1)])]),_:1}),e(y,null,{default:l(()=>[...t[26]||(t[26]=[i("Report ID",-1)])]),_:1}),e(y,null,{default:l(()=>[...t[27]||(t[27]=[i("Date Range",-1)])]),_:1}),e(y,null,{default:l(()=>[...t[28]||(t[28]=[i("Records",-1)])]),_:1}),e(y,null,{default:l(()=>[...t[29]||(t[29]=[i("SPF Pass",-1)])]),_:1}),e(y,null,{default:l(()=>[...t[30]||(t[30]=[i("DKIM Pass",-1)])]),_:1}),e(y,null,{default:l(()=>[...t[31]||(t[31]=[i("Failed",-1)])]),_:1}),e(y,null,{default:l(()=>[...t[32]||(t[32]=[i("Actions",-1)])]),_:1})]),_:1})]),_:1}),e(mt,null,{default:l(()=>[(m(!0),A(Y,null,Z(lt.value,d=>(m(),R(P,{key:d.id},{default:l(()=>[e(f,null,{default:l(()=>[e(a,{variant:"ghost",size:"sm",onClick:Q=>nt(d.id)},{default:l(()=>[F.value.includes(d.id)?(m(),R(v(Tt),{key:1,class:"h-4 w-4"})):(m(),R(v(At),{key:0,class:"h-4 w-4"}))]),_:2},1032,["onClick"])]),_:2},1024),e(f,{class:"font-medium"},{default:l(()=>[i(s(d.domain),1)]),_:2},1024),e(f,null,{default:l(()=>[i(s(d.org_name),1)]),_:2},1024),e(f,{class:"font-mono text-xs"},{default:l(()=>[i(s(d.report_id),1)]),_:2},1024),e(f,null,{default:l(()=>[o("div",Wt,[i(s(G(d.begin_time))+" -",1),t[33]||(t[33]=o("br",null,null,-1)),i(" "+s(G(d.end_time)),1)])]),_:2},1024),e(f,null,{default:l(()=>[i(s(d.record_count),1)]),_:2},1024),e(f,null,{default:l(()=>[e(j,{variant:J(d.spf_aligned_count,d.record_count)},{default:l(()=>[i(s(d.spf_aligned_count),1)]),_:2},1032,["variant"])]),_:2},1024),e(f,null,{default:l(()=>[e(j,{variant:J(d.dkim_aligned_count,d.record_count)},{default:l(()=>[i(s(d.dkim_aligned_count),1)]),_:2},1032,["variant"])]),_:2},1024),e(f,null,{default:l(()=>[e(j,{variant:"destructive"},{default:l(()=>[i(s(d.failed_count),1)]),_:2},1024)]),_:2},1024),e(f,null,{default:l(()=>[o("div",Yt,[e(a,{variant:"ghost",size:"sm",onClick:Q=>X(d.id,"csv"),title:"Export CSV"},{default:l(()=>[e(v(z),{class:"h-4 w-4"})]),_:1},8,["onClick"]),e(a,{variant:"ghost",size:"sm",onClick:Q=>X(d.id,"xml"),title:"Export XML"},{default:l(()=>[e(v(z),{class:"h-4 w-4"})]),_:1},8,["onClick"])])]),_:2},1024)]),_:2},1024))),128)),F.value.includes(n.report.id)?(m(),R(P,{key:`${n.report.id}-expanded`},{default:l(()=>[e(f,{colspan:10,class:"p-4 bg-gray-50"},{default:l(()=>[o("div",Zt,[o("div",null,[t[38]||(t[38]=o("h4",{class:"font-semibold mb-2"},"Report Details",-1)),o("div",te,[o("div",null,[t[34]||(t[34]=o("span",{class:"text-gray-500"},"Email Address:",-1)),o("p",ee,s(n.report.email_address),1)]),o("div",null,[t[35]||(t[35]=o("span",{class:"text-gray-500"},"Report ID:",-1)),o("p",le,s(n.report.report_id),1)]),o("div",null,[t[36]||(t[36]=o("span",{class:"text-gray-500"},"Begin Time:",-1)),o("p",null,s(D(n.report.begin_time)),1)]),o("div",null,[t[37]||(t[37]=o("span",{class:"text-gray-500"},"End Time:",-1)),o("p",null,s(D(n.report.end_time)),1)])])]),o("div",null,[t[43]||(t[43]=o("h4",{class:"font-semibold mb-2"},"Authentication Breakdown",-1)),o("div",oe,[e(b,null,{default:l(()=>[e(x,{class:"pt-4"},{default:l(()=>[t[39]||(t[39]=o("div",{class:"text-xs text-gray-500"},"SPF Pass Rate",-1)),o("div",ne,s((n.report.spf_aligned_count/n.report.record_count*100).toFixed(1))+"% ",1),o("div",ae,s(n.report.spf_aligned_count)+" / "+s(n.report.record_count),1)]),_:1})]),_:1}),e(b,null,{default:l(()=>[e(x,{class:"pt-4"},{default:l(()=>[t[40]||(t[40]=o("div",{class:"text-xs text-gray-500"},"DKIM Pass Rate",-1)),o("div",se,s((n.report.dkim_aligned_count/n.report.record_count*100).toFixed(1))+"% ",1),o("div",de,s(n.report.dkim_aligned_count)+" / "+s(n.report.record_count),1)]),_:1})]),_:1}),e(b,null,{default:l(()=>[e(x,{class:"pt-4"},{default:l(()=>[t[41]||(t[41]=o("div",{class:"text-xs text-gray-500"},"Both Aligned",-1)),o("div",ie,s((n.report.both_aligned_count/n.report.record_count*100||0).toFixed(1))+"% ",1),o("div",re,s(n.report.both_aligned_count)+" / "+s(n.report.record_count),1)]),_:1})]),_:1}),e(b,null,{default:l(()=>[e(x,{class:"pt-4"},{default:l(()=>[t[42]||(t[42]=o("div",{class:"text-xs text-gray-500"},"Failed",-1)),o("div",ue,s((n.report.failed_count/n.report.record_count*100).toFixed(1))+"% ",1),o("div",_e,s(n.report.failed_count)+" / "+s(n.report.record_count),1)]),_:1})]),_:1})])])])]),_:1})]),_:1})):H("",!0)]),_:1})]),_:1})),h.value>1?(m(),A("div",me,[o("div",ce," Showing "+s((C.value-1)*M.value+1)+" to "+s(Math.min(C.value*M.value,L.value))+" of "+s(L.value)+" reports ",1),o("div",pe,[e(a,{variant:"outline",size:"sm",onClick:t[4]||(t[4]=d=>C.value--),disabled:C.value===1},{default:l(()=>[...t[44]||(t[44]=[i(" Previous ",-1)])]),_:1},8,["disabled"]),e(a,{variant:"outline",size:"sm",onClick:t[5]||(t[5]=d=>C.value++),disabled:C.value===h.value},{default:l(()=>[...t[45]||(t[45]=[i(" Next ",-1)])]),_:1},8,["disabled"])])])):H("",!0)]),_:1})]),_:1}),T.value?(m(),R(vt,{key:0,variant:"destructive"},{default:l(()=>[e(v(Ft),{class:"h-4 w-4"}),e(pt,null,{default:l(()=>[...t[46]||(t[46]=[i("Error",-1)])]),_:1}),e(ft,null,{default:l(()=>[i(s(T.value),1)]),_:1})]),_:1})):H("",!0)])}}});export{Ee as default};
