import{_ as R}from"./TWhVIJrq.js";import{_ as N}from"./DDnXcZAG.js";import{u as P}from"./DEEVIwE6.js";import{u as V}from"./vkYvzIJb.js";import{R as H}from"./D0UlAAtA.js";import{M as G}from"./B3e0D3rj.js";import{c as B}from"./BDTT5SEM.js";import{f as O,q as k,p as q,y as X,c as i,a as e,b as o,w as n,t as a,F as K,G as W,D as M,o as c,d as p,C as _,n as J,g as Y}from"./BUcYa01A.js";import"./DAzf46mh.js";import"./CYi_maFl.js";const Z=B("CircleXIcon",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]);const ee=B("ClockIcon",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]),te=()=>typeof window<"u"?localStorage.getItem("token"):null,w=()=>{const d=te();return{"Content-Type":"application/json",...d?{Authorization:`Bearer ${d}`}:{}}},se=()=>{const d=V();return{getQueue:async()=>{const u=await fetch(`${d}/queue`,{method:"GET",headers:w()});if(!u.ok)throw new Error("Failed to fetch queue");return(await u.json()).data||[]},retryMessage:async u=>{if(!(await fetch(`${d}/queue/${u}/retry`,{method:"POST",headers:w()})).ok)throw new Error("Failed to retry message")},deleteMessage:async u=>{if(!(await fetch(`${d}/queue/${u}`,{method:"DELETE",headers:w()})).ok)throw new Error("Failed to delete message")},refreshQueue:async()=>{await fetch(`${d}/queue/refresh`,{method:"POST",headers:w()})}}},oe={class:"border-b"},ne={class:"flex h-16 items-center px-4"},re={class:"ml-auto"},ae={class:"flex-1 p-4 md:p-8"},le={class:"flex items-center justify-between mb-6"},de={class:"grid gap-4 md:grid-cols-3 mb-6"},ue={class:"text-2xl font-bold"},ie={class:"text-2xl font-bold"},ce={class:"text-2xl font-bold"},fe={key:0,class:"text-center py-12"},me={key:1,class:"bg-destructive/10 text-destructive px-4 py-3 rounded-lg"},xe={key:2,class:"text-center py-12 bg-card rounded-lg border border-border"},pe={key:3,class:"bg-card rounded-lg border border-border overflow-hidden"},ge={class:"w-full"},ye={class:"px-6 py-4 text-sm text-foreground font-mono"},he={class:"px-6 py-4 text-sm text-foreground"},_e={class:"px-6 py-4 text-sm text-foreground"},we={class:"px-6 py-4 text-sm text-foreground max-w-xs truncate"},ve={class:"px-6 py-4 text-sm text-muted-foreground"},be={class:"px-6 py-4 text-sm text-muted-foreground"},Ce={class:"px-6 py-4 text-sm"},ke={class:"px-6 py-4 text-sm text-muted-foreground"},Me={class:"px-6 py-4 text-sm"},Te=["onClick"],$e=["onClick"],ze=O({__name:"index",setup(d){const T=P(),{getQueue:$,retryMessage:A,deleteMessage:S,refreshQueue:u}=se(),g=()=>{T.logout()},f=k([]),y=k(!1),m=k(null),h=async()=>{y.value=!0,m.value=null;try{const s=await $();f.value=s}catch(s){m.value=s.message}finally{y.value=!1}},D=async()=>{await u(),await h()},E=async s=>{try{await A(s),await h()}catch(t){m.value=t.message}},Q=async s=>{if(confirm("Are you sure you want to delete this message? This action cannot be undone."))try{await S(s),await h()}catch(t){m.value=t.message}},F=q(()=>f.value.filter(s=>["pending","retrying"].includes(s.status)).length),j=q(()=>f.value.filter(s=>s.status==="failed").length),U=s=>s?s<1024?`${s} B`:s<1048576?`${(s/1024).toFixed(1)} KB`:`${(s/1048576).toFixed(1)} MB`:"0 B",z=s=>{const t=new Date,x=new Date(s),l=Math.floor((t.getTime()-x.getTime())/1e3);return l<60?`${l}s ago`:l<3600?`${Math.floor(l/60)}m ago`:l<86400?`${Math.floor(l/3600)}h ago`:x.toLocaleDateString()},I=s=>{switch(s){case"pending":return"bg-blue-100 text-blue-800";case"processing":return"bg-yellow-100 text-yellow-800";case"retrying":return"bg-orange-100 text-orange-800";case"failed":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}};return X(()=>{h()}),(s,t)=>{const x=R,l=M("UCardTitle"),v=M("UCardHeader"),b=M("UCardContent"),C=N;return c(),i("div",null,[e("div",oe,[e("div",ne,[t[1]||(t[1]=e("h1",{class:"text-lg font-semibold"},"Admin Console",-1)),e("div",re,[o(x,{variant:"outline",onClick:g},{default:n(()=>[...t[0]||(t[0]=[p(" Logout ",-1)])]),_:1})])])]),e("div",ae,[e("div",le,[t[3]||(t[3]=e("h2",{class:"text-3xl font-bold tracking-tight"},"Mail Queue",-1)),o(x,{onClick:D,disabled:y.value},{default:n(()=>[o(_(H),{class:"mr-2 h-4 w-4"}),t[2]||(t[2]=p(" Refresh Queue ",-1))]),_:1},8,["disabled"])]),e("div",de,[o(C,null,{default:n(()=>[o(v,{class:"flex flex-row items-center justify-between space-y-0 pb-2"},{default:n(()=>[o(l,{class:"text-sm font-medium"},{default:n(()=>[...t[4]||(t[4]=[p("Total Messages",-1)])]),_:1}),o(_(G),{class:"h-4 w-4 text-muted-foreground"})]),_:1}),o(b,null,{default:n(()=>[e("div",ue,a(f.value.length),1),t[5]||(t[5]=e("p",{class:"text-xs text-muted-foreground"},"In queue",-1))]),_:1})]),_:1}),o(C,null,{default:n(()=>[o(v,{class:"flex flex-row items-center justify-between space-y-0 pb-2"},{default:n(()=>[o(l,{class:"text-sm font-medium"},{default:n(()=>[...t[6]||(t[6]=[p("Pending",-1)])]),_:1}),o(_(ee),{class:"h-4 w-4 text-yellow-500"})]),_:1}),o(b,null,{default:n(()=>[e("div",ie,a(F.value),1),t[7]||(t[7]=e("p",{class:"text-xs text-muted-foreground"},"Waiting to send",-1))]),_:1})]),_:1}),o(C,null,{default:n(()=>[o(v,{class:"flex flex-row items-center justify-between space-y-0 pb-2"},{default:n(()=>[o(l,{class:"text-sm font-medium"},{default:n(()=>[...t[8]||(t[8]=[p("Failed",-1)])]),_:1}),o(_(Z),{class:"h-4 w-4 text-red-500"})]),_:1}),o(b,null,{default:n(()=>[e("div",ce,a(j.value),1),t[9]||(t[9]=e("p",{class:"text-xs text-muted-foreground"},"Delivery errors",-1))]),_:1})]),_:1})]),y.value?(c(),i("div",fe,[...t[10]||(t[10]=[e("p",{class:"text-muted-foreground"},"Loading queue...",-1)])])):m.value?(c(),i("div",me," Error loading queue: "+a(m.value),1)):f.value.length===0?(c(),i("div",xe,[...t[11]||(t[11]=[e("p",{class:"text-muted-foreground"},"No messages in queue. All emails sent successfully.",-1)])])):(c(),i("div",pe,[e("table",ge,[t[12]||(t[12]=e("thead",{class:"bg-muted/50"},[e("tr",null,[e("th",{class:"px-6 py-3 text-left text-sm font-medium text-foreground"},"ID"),e("th",{class:"px-6 py-3 text-left text-sm font-medium text-foreground"},"From"),e("th",{class:"px-6 py-3 text-left text-sm font-medium text-foreground"},"To"),e("th",{class:"px-6 py-3 text-left text-sm font-medium text-foreground"},"Subject"),e("th",{class:"px-6 py-3 text-left text-sm font-medium text-foreground"},"Size"),e("th",{class:"px-6 py-3 text-left text-sm font-medium text-foreground"},"Attempts"),e("th",{class:"px-6 py-3 text-left text-sm font-medium text-foreground"},"Status"),e("th",{class:"px-6 py-3 text-left text-sm font-medium text-foreground"},"Created"),e("th",{class:"px-6 py-3 text-left text-sm font-medium text-foreground"},"Actions")])],-1)),e("tbody",null,[(c(!0),i(K,null,W(f.value,r=>(c(),i("tr",{key:r.id,class:"border-t border-border"},[e("td",ye,a(r.id),1),e("td",he,a(r.from),1),e("td",_e,a(r.to),1),e("td",we,a(r.subject),1),e("td",ve,a(U(r.size)),1),e("td",be,a(r.attempts||1),1),e("td",Ce,[e("span",{class:J(["inline-flex items-center rounded-full px-2.5 py-0.5 text-xs font-medium",I(r.status)])},a(r.status),3)]),e("td",ke,a(z(r.created_at)),1),e("td",Me,[r.status==="failed"?(c(),i("button",{key:0,onClick:L=>E(r.id),class:"text-yellow-600 hover:underline mr-2"}," Retry ",8,Te)):Y("",!0),e("button",{onClick:L=>Q(r.id),class:"text-red-600 hover:underline"}," Delete ",8,$e)])]))),128))])])]))])])}}});export{ze as default};
